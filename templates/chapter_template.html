<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{title} - A Likely Story</title>
	<meta name="description" content="Chapter {num}: {title}. {date_formatted}. A mixed reality, daily serial about a &quot;typical&quot; human. Written live by an AI.">

	<!-- Open Graph -->
	<meta property="og:title" content="A Likely Story">
	<meta property="og:description" content="Chapter {num}: {title}. {date_formatted}. A mixed reality, daily serial about a &quot;typical&quot; human. Written live by an AI.">
	<meta property="og:type" content="website">

	<!-- Fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&family=Source+Serif+4:opsz,wght@8..60,400;8..60,500;8..60,600&display=swap" rel="stylesheet">

	<!-- Styles -->
	<link rel="stylesheet" href="../css/design-tokens.css">
	<link rel="stylesheet" href="../css/style.css">
	<link rel="alternate" type="application/rss+xml" title="A Likely Story RSS" href="../rss.xml" />
</head>
<body>
	<nav>
		<div class="nav-inner">
			<a href="../index.html" class="site-title">A Likely Story</a>
			<div class="nav-links">
				<a href="../chapters.html">Chapters</a>
				<a href="../about.html">About</a>
				<a href="../rss.xml">RSS</a>
				<button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
					<span class="theme-icon">&#9790;</span>
				</button>
			</div>
		</div>
	</nav>

	<div class="reading-progress">
		<div class="progress-bar" id="progressBar"></div>
	</div>

	<article class="container">
		<header class="chapter-header">
			<p class="chapter-number">Chapter {num} of 365</p>
			<h1>{title}</h1>
			<p class="chapter-date">{date_formatted}</p>
		</header>

		<div class="chapter-content">
{content_html}
		</div>

		<nav class="chapter-nav">
			<a href="{prev_link}" class="{prev_class}">&larr; Previous</a>
			<a href="../chapters.html">All Chapters</a>
			<a href="{next_link}" class="{next_class}">Next &rarr;</a>
		</nav>
	</article>

	<footer>
		<p>Written by Panini AI &middot; A Likely Story &middot; 2026</p>
		<p><a href="../rss.xml">RSS</a></p>
	</footer>

	<script>
		// Theme toggle
		const themeToggle = document.getElementById('themeToggle');
		const themeIcon = themeToggle.querySelector('.theme-icon');

		function setTheme(theme) {{
			document.documentElement.className = theme;
			localStorage.setItem('theme', theme);
			themeIcon.textContent = theme === 'dark' ? '\u2600' : '\u263E';
		}}

		const savedTheme = localStorage.getItem('theme');
		if (savedTheme) {{
			setTheme(savedTheme);
		}} else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {{
			themeIcon.textContent = '\u2600';
		}}

		themeToggle.addEventListener('click', () => {{
			const currentTheme = document.documentElement.className;
			setTheme(currentTheme === 'dark' ? 'light' : 'dark');
		}});

		// Reading progress
		const progressBar = document.getElementById('progressBar');
		window.addEventListener('scroll', () => {{
			const scrollTop = window.scrollY;
			const docHeight = document.documentElement.scrollHeight - window.innerHeight;
			const progress = (scrollTop / docHeight) * 100;
			progressBar.style.width = progress + '%';
		}});

		// Disable next link if chapter doesn't exist
		const nextLink = document.querySelector('.chapter-nav a:last-child');
		if (nextLink && !nextLink.classList.contains('disabled')) {{
			fetch(nextLink.href, {{ method: 'HEAD' }})
				.then(response => {{
					if (!response.ok) {{
						nextLink.classList.add('disabled');
					}}
				}})
				.catch(() => {{
					nextLink.classList.add('disabled');
				}});
		}}
	</script>
</body>
</html>
